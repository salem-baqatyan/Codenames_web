<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Codenames Pro - Home</title>
    <style>
        :root {
            --bg-dark: #000000; --panel-bg: #1a1a1a; --accent-gold: #f1c40f;
            --green-action: #4caf50; --text-gray: #aaaaaa; --modal-bg: #2a2a2a; 
            --mobile-max-width: 450px;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { 
            margin: 0; background-color: var(--bg-dark); color: white; 
            display: flex; justify-content: center; align-items: center; height: 100dvh; overflow: hidden; 
        }

        .mobile-wrapper {
            width: 100%; max-width: var(--mobile-max-width); height: 100dvh; background: #000;
            display: flex; flex-direction: column; border-left: 1px solid #333; border-right: 1px solid #333;
            position: relative; padding: 20px;
        }

        /* --- Header Section --- */
        .logo-section { text-align: center; margin-top: 20px; margin-bottom: 30px; }
        .logo-title { font-size: 2.2rem; font-weight: 900; letter-spacing: 2px; color: var(--accent-gold); text-shadow: 0 0 15px rgba(241, 196, 15, 0.4); }
        .logo-subtitle { color: var(--text-gray); font-size: 0.8rem; margin-top: 5px; }

        /* --- Action Panels --- */
        .panel { background: var(--panel-bg); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid #333; }
        .panel-title { font-size: 0.9rem; font-weight: bold; margin-bottom: 12px; color: #eee; display: flex; align-items: center; gap: 8px; }
        
        .input-group { display: flex; gap: 8px; }
        .main-input { flex: 1; background: #000; border: 1px solid #444; color: white; padding: 12px; border-radius: 12px; font-size: 0.9rem; outline: none; }
        .main-input:focus { border-color: var(--accent-gold); }

        .btn { border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-gold { background: var(--accent-gold); color: black; padding: 12px 20px; }
        .btn-outline { background: transparent; border: 1px solid var(--accent-gold); color: var(--accent-gold); padding: 10px; width: 100%; margin-top: 10px; }

        /* --- Room List Table --- */
        .rooms-container { flex: 1; overflow-y: auto; margin-top: 5px; }
        .rooms-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .rooms-table th { text-align: right; color: var(--text-gray); padding: 10px; border-bottom: 1px solid #333; position: sticky; top: 0; background: #000; }
        .rooms-table td { padding: 12px 10px; border-bottom: 1px solid #222; }
        .status-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .status-lobby { background: #2ecc7133; color: #2ecc71; }
        .status-game { background: #e67e2233; color: #e67e22; }

        /* --- Radio Selectors --- */
        .radio-group { display: flex; gap: 10px; margin-top: 10px; }
        .radio-option { flex: 1; background: #000; padding: 8px; border-radius: 8px; border: 1px solid #444; text-align: center; font-size: 0.75rem; cursor: pointer; }
        .radio-option.active { border-color: var(--green-action); color: var(--green-action); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body>

<div class="mobile-wrapper">
    <div class="logo-section">
        <div class="logo-title">CODENAMES</div>
        <div class="logo-subtitle">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© â€¢ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
    </div>

    <div class="panel">
        <div class="panel-title"><span>ğŸ”‘</span> Ø§Ù†Ø¶Ù…Ø§Ù… Ø³Ø±ÙŠØ¹</div>
        <div class="input-group">
            <input type="text" id="joinIdInput" class="main-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø·">
            <button class="btn btn-gold" onclick="joinRoom()">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
        </div>
    </div>

    <div class="panel">
        <div class="panel-title"><span>ğŸ†•</span> Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</div>
        <div class="radio-group">
            <div class="radio-option active" onclick="selectType(this, 'public')">Ø¹Ø§Ù…Ø© (Public)</div>
            <div class="radio-option" onclick="selectType(this, 'private')">Ø®Ø§ØµØ© (Private)</div>
        </div>
        <button class="btn btn-outline" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¯Ø®ÙˆÙ„ ÙƒØ¢Ø¯Ù…Ù†</button>
    </div>

    <div class="panel" style="flex: 1; display: flex; flex-direction: column;">
        <div class="panel-title"><span>ğŸŒ</span> Ø§Ù„ØºØ±Ù Ø§Ù„Ø¹Ø§Ù…Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©</div>
        <div class="rooms-container">
            <table class="rooms-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø±Ù…Ø²</th>
                        <th>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody id="roomsListBody">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC95r_D7FVO-cynZ-gK6zbldvvrY4HD2YQ",
        authDomain: "codenames-5fd71.firebaseapp.com",
        projectId: "codenames-5fd71",
        databaseURL: "https://codenames-5fd71-default-rtdb.firebaseio.com",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let selectedRoomType = 'public';

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
    window.selectType = (el, type) => {
        document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('active'));
        el.classList.add('active');
        selectedRoomType = type;
    };

    window.joinRoom = () => {
        let val = document.getElementById('joinIdInput').value.trim();
        if (!val) return;
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ ID Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙƒØ§Ù…Ù„Ø§Ù‹
        if (val.includes('?r=')) {
            val = new URL(val).searchParams.get('r');
        }
        location.href = `lobby.html?r=${val}`;
    };

    window.createRoom = () => {
        const newId = Math.random().toString(36).substring(2, 8);
        // Ù‡Ù†Ø§ Ù†Ù‚ÙˆÙ… Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙˆØ§Ù„Ù€ Lobby Ø³ÙŠØªÙƒÙÙ„ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase
        // Ù„ÙƒÙ†Ù†Ø§ Ø³Ù†Ø¶ÙŠÙ Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ± t Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ÙˆØ¹
        location.href = `lobby.html?r=${newId}&type=${selectedRoomType}`;
    };

    // --- Ø¬Ù„Ø¨ Ø§Ù„ØºØ±Ù Ø§Ù„Ø¹Ø§Ù…Ø© ---
    const roomsRef = ref(db, 'rooms');
    onValue(roomsRef, (snapshot) => {
        const rooms = snapshot.val();
        const tbody = document.getElementById('roomsListBody');
        tbody.innerHTML = '';

        if (!rooms) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù Ø¹Ø§Ù…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>';
            return;
        }

        for (let id in rooms) {
            const room = rooms[id];
            // Ø¹Ø±Ø¶ Ø§Ù„ØºØ±Ù Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙ‚Ø·
            if (room.settings?.visibility === 'private') continue;

            const playersCount = room.players ? Object.keys(room.players).length : 0;
            const statusText = room.status === 'started' ? 'ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©' : 'Ø§Ù„Ø±Ø¯Ù‡Ø©';
            const statusClass = room.status === 'started' ? 'status-game' : 'status-lobby';

            const tr = document.createElement('tr');
            tr.style.cursor = 'pointer';
            tr.onclick = () => location.href = `lobby.html?r=${id}`;
            tr.innerHTML = `
                <td style="font-family:monospace; color:var(--accent-gold); font-weight:bold;">${id}</td>
                <td>ğŸ‘¤ ${playersCount}/10</td>
                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
            `;
            tbody.appendChild(tr);
        }
    });
</script>

</body>
</html>